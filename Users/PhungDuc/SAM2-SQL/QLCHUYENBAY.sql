CREATE DATABASE QLCHUYENBAY_SCRIPT

USE QLCHUYENBAY_SCRIPT

-- TAO BANG KHACHHANG

IF EXISTS (SELECT * FROM DBO.SYSOBJECTS WHERE NAME='KHACHHANG')
BEGIN
	DROP TABLE KHACHHANG
END
GO
CREATE TABLE KHACHHANG
(
	MAKH	VARCHAR(15),
	TEN		NVARCHAR(15),
	DCHI	NVARCHAR(50),
	DTHOAI	VARCHAR(12)
	PRIMARY KEY (MAKH)
)

-- TAO BANG NHANVIEN
IF EXISTS (SELECT * FROM DBO.SYSOBJECTS WHERE NAME='NHANVIEN')
BEGIN
	DROP TABLE NHANVIEN
END
GO
CREATE TABLE NHANVIEN
(
	MANV	VARCHAR(15),
	TEN		NVARCHAR(15),
	DCHI	NVARCHAR(50),
	DTHOAI	VARCHAR(12),
	LUONG	NUMERIC,
	LOAINV	BIT
	PRIMARY KEY (MANV)
)

-- TAO BANG LOAIMB
IF EXISTS (SELECT * FROM DBO.SYSOBJECTS WHERE NAME='LOAIMB')
BEGIN
	DROP TABLE LOAIMB
END
GO
CREATE TABLE LOAIMB
(
	MALOAI	VARCHAR(15),
	HANGSX	VARCHAR(15)
	PRIMARY KEY (MALOAI)
)
-- TAO BANG MAYBAY

IF EXISTS (SELECT * FROM DBO.SYSOBJECTS WHERE NAME='MAYBAY')
BEGIN
	DROP TABLE MAYBAY
END
GO
CREATE TABLE MAYBAY
(
	SOHIEU	INT,
	MALOAI	VARCHAR(15)
	PRIMARY KEY (SOHIEU,MALOAI)
)

--TAO BANG CHUYENBAY
IF EXISTS (SELECT * FROM DBO.SYSOBJECTS WHERE NAME='CHUYENBAY')
BEGIN
	DROP TABLE CHUYENBAY
END
GO
CREATE TABLE CHUYENBAY
(
	MACB	VARCHAR(4),
	SBDI	VARCHAR(3),
	SBDEN	VARCHAR(3),
	GIODI	DATETIME,
	GIODEN	DATETIME
	PRIMARY KEY (MACB)
)

--TAO BANG LICHBAY
IF EXISTS (SELECT * FROM DBO.SYSOBJECTS WHERE NAME='LICHBAY')
BEGIN
	DROP TABLE LICHBAY
END
GO
CREATE TABLE LICHBAY
(
	NGAYDI	SMALLDATETIME,
	MACB	VARCHAR(4),
	SOHIEU	INT,
	MALOAI	VARCHAR(15),
	PRIMARY KEY(NGAYDI,MACB)
)

--TAO BANG DATCHO
IF EXISTS (SELECT * FROM DBO.SYSOBJECTS WHERE NAME='DATCHO')
BEGIN
	DROP TABLE DATCHO
END
GO
CREATE TABLE DATCHO
(
	MAKH	VARCHAR(15),
	NGAYDI	SMALLDATETIME,
	MACB	VARCHAR(4)
)

-- TAO BANG KHANANG
IF EXISTS (SELECT * FROM DBO.SYSOBJECTS WHERE NAME='KHANANG')
BEGIN
	DROP TABLE KHANANG
END
GO
CREATE TABLE KHANANG
(
	MANV	VARCHAR(15),
	MALOAI	VARCHAR(15)
	PRIMARY KEY(MANV,MALOAI)
)

-- TAO BANG PHANCONG
IF EXISTS (SELECT * FROM DBO.SYSOBJECTS WHERE NAME='PHANCONG')
BEGIN
	DROP TABLE PHANCONG
END
GO
CREATE TABLE PHANCONG
(
	MANV	VARCHAR(15),
	NGAYDI	SMALLDATETIME,
	MACB	VARCHAR(4)
)

-- THIET LAP KHOA NGOAI

ALTER TABLE DATCHO
ADD CONSTRAINT FK_DATCHO_KHACHHANG
FOREIGN KEY (MAKH) REFERENCES KHACHHANG(MAKH)

ALTER TABLE DATCHO
ADD CONSTRAINT FK_DATCHO_LICHBAY
FOREIGN KEY (NGAYDI,MACB) REFERENCES LICHBAY(NGAYDI,MACB)

ALTER TABLE LICHBAY
ADD CONSTRAINT FK_LICHBAY_CHUYENBAY
FOREIGN KEY (MACB) REFERENCES CHUYENBAY(MACB)

ALTER TABLE LICHBAY
ADD CONSTRAINT FK_LICHBAY_MAYBAY
FOREIGN KEY (SOHIEU,MALOAI) REFERENCES MAYBAY(SOHIEU,MALOAI)

ALTER TABLE KHANANG
ADD CONSTRAINT FK_KHANANG_NHANVIEN
FOREIGN KEY (MANV) REFERENCES NHANVIEN(MANV)

ALTER TABLE KHANANG
ADD CONSTRAINT FK_KHANANG_LOAIMB
FOREIGN KEY (MALOAI) REFERENCES LOAIMB(MALOAI)

ALTER TABLE MAYBAY
ADD CONSTRAINT FK_MAYBAY_LOAIMB
FOREIGN KEY (MALOAI) REFERENCES LOAIMB(MALOAI)

ALTER TABLE PHANCONG
ADD CONSTRAINT FK_PHANCONG_LICHBAY
FOREIGN KEY (NGAYDI,MACB) REFERENCES LICHBAY(NGAYDI,MACB)

ALTER TABLE PHANCONG
ADD CONSTRAINT FK_PHANCONG_NHANVIEN
FOREIGN KEY (MANV) REFERENCES NHANVIEN(MANV)

--NHAP LIEU NHANVIEN

INSERT INTO NHANVIEN(MANV,TEN,DCHI,DTHOAI,LUONG,LOAINV)
VALUES (1006,'Chi','12/6 Nguyen Kiem',08120012,150000,0)

INSERT INTO NHANVIEN(MANV,TEN,DCHI,DTHOAI,LUONG,LOAINV)
VALUES (1005,'Giao','65 Nguyen Thai Son',8324467,500000,0)

INSERT INTO NHANVIEN(MANV,TEN,DCHI,DTHOAI,LUONG,LOAINV)
VALUES (1001,'Huong','8 Dien Bien Phu',8330733,500000,1)

INSERT INTO NHANVIEN(MANV,TEN,DCHI,DTHOAI,LUONG,LOAINV)
VALUES (1002,'Phong','1 Ly Thuong Kiet',8308117,450000,1)

INSERT INTO NHANVIEN(MANV,TEN,DCHI,DTHOAI,LUONG,LOAINV)
VALUES (1004,'Phuong','351 Lac Long Quan',8308155,250000,0)

INSERT INTO NHANVIEN(MANV,TEN,DCHI,DTHOAI,LUONG,LOAINV)
VALUES (1003,'Quang','78 Truong Dinh',8324461,350000,1)

INSERT INTO NHANVIEN(MANV,TEN,DCHI,DTHOAI,LUONG,LOAINV)
VALUES (1007,'Tam','36 Nguyen Van Cu',8458188,500000,0)

-- NHAP LIEU KHACHHANG

INSERT INTO KHACHHANG(MAKH,TEN,DCHI,DTHOAI)
VALUES (0009,'Nga','233 Nguyen Trai',8932320)

INSERT INTO KHACHHANG(MAKH,TEN,DCHI,DTHOAI)
VALUES (0101,'Anh','567 Tran Phu',8826829)

INSERT INTO KHACHHANG(MAKH,TEN,DCHI,DTHOAI)
VALUES (0045,'Thu','285 Le Loi',8932203)

INSERT INTO KHACHHANG(MAKH,TEN,DCHI,DTHOAI)
VALUES (0012,'Ha','435 Quang Trung',8933232)

INSERT INTO KHACHHANG(MAKH,TEN,DCHI,DTHOAI)
VALUES (0238,'Hung','456 Pasteur',9812101)

INSERT INTO KHACHHANG(MAKH,TEN,DCHI,DTHOAI)
VALUES (0397,'Thanh','234 Le Van Si',8952943)

INSERT INTO KHACHHANG(MAKH,TEN,DCHI,DTHOAI)
VALUES (0582,'Mai','789 Nguyen Du','')

INSERT INTO KHACHHANG(MAKH,TEN,DCHI,DTHOAI)
VALUES (0934,'Minh','678 Le Lai','')

INSERT INTO KHACHHANG(MAKH,TEN,DCHI,DTHOAI)
VALUES (0091,'Hai','345 Hung Vuong',8893223)

INSERT INTO KHACHHANG(MAKH,TEN,DCHI,DTHOAI)
VALUES (0314,'Phuong','395 Vo Van Tan',8232320)

INSERT INTO KHACHHANG(MAKH,TEN,DCHI,DTHOAI)
VALUES (0613,'Vu','348 CMT8',8343232)

INSERT INTO KHACHHANG(MAKH,TEN,DCHI,DTHOAI)
VALUES (0586,'Son','123 Bach Dang',8556223)

INSERT INTO KHACHHANG(MAKH,TEN,DCHI,DTHOAI)
VALUES (0422,'Tien','75 Nguyen Thong',8332222)

--NHAP LIEU LOAIMB

INSERT INTO LOAIMB(HANGSX,MALOAI)
VALUES ('Airbus','A310')

INSERT INTO LOAIMB(HANGSX,MALOAI)
VALUES ('Airbus','A320')

INSERT INTO LOAIMB(HANGSX,MALOAI)
VALUES ('Airbus','A330')

INSERT INTO LOAIMB(HANGSX,MALOAI)
VALUES ('Airbus','A340')

INSERT INTO LOAIMB(HANGSX,MALOAI)
VALUES ('Boeing','B727')

INSERT INTO LOAIMB(HANGSX,MALOAI)
VALUES ('Boeing','B747')

INSERT INTO LOAIMB(HANGSX,MALOAI)
VALUES ('Boeing','B757')

INSERT INTO LOAIMB(HANGSX,MALOAI)
VALUES ('MD','DC10')

INSERT INTO LOAIMB(HANGSX,MALOAI)
VALUES ('MD','DC9')

--NHAP LIEU KHANANG

INSERT INTO KHANANG(MANV,MALOAI)
VALUES (1001,'B727')

INSERT INTO KHANANG(MANV,MALOAI)
VALUES (1001,'B747')

INSERT INTO KHANANG(MANV,MALOAI)
VALUES (1001,'DC10')

INSERT INTO KHANANG(MANV,MALOAI)
VALUES (1001,'DC9')

INSERT INTO KHANANG(MANV,MALOAI)
VALUES (1002,'A320')

INSERT INTO KHANANG(MANV,MALOAI)
VALUES (1002,'A340')

INSERT INTO KHANANG(MANV,MALOAI)
VALUES (1002,'B757')

INSERT INTO KHANANG(MANV,MALOAI)
VALUES (1002,'DC9')

INSERT INTO KHANANG(MANV,MALOAI)
VALUES (1003,'A310')

INSERT INTO KHANANG(MANV,MALOAI)
VALUES (1003,'DC9')

--NHAP LIEU MAYBAY

INSERT INTO MAYBAY(SOHIEU,MALOAI)
VALUES (10,'B747')


INSERT INTO MAYBAY(SOHIEU,MALOAI)
VALUES (11,'B727')


INSERT INTO MAYBAY(SOHIEU,MALOAI)
VALUES (13,'B727')


INSERT INTO MAYBAY(SOHIEU,MALOAI)
VALUES (13,'B747')

INSERT INTO MAYBAY(SOHIEU,MALOAI)
VALUES (21,'DC10')

INSERT INTO MAYBAY(SOHIEU,MALOAI)
VALUES (21,'DC9')

INSERT INTO MAYBAY(SOHIEU,MALOAI)
VALUES (22,'B757')

INSERT INTO MAYBAY(SOHIEU,MALOAI)
VALUES (22,'DC9')

INSERT INTO MAYBAY(SOHIEU,MALOAI)
VALUES (23,'DC9')

INSERT INTO MAYBAY(SOHIEU,MALOAI)
VALUES (24,'DC9')

INSERT INTO MAYBAY(SOHIEU,MALOAI)
VALUES (70,'A310')

INSERT INTO MAYBAY(SOHIEU,MALOAI)
VALUES (80,'A310')

INSERT INTO MAYBAY(SOHIEU,MALOAI)
VALUES (93,'B757')

--NHAP LIEU CHUYENBAY

INSERT INTO CHUYENBAY(MACB,SBDI,SBDEN,GIODI,GIODEN)
VALUES(100,'SLC','BOS','08:00','17:50')

INSERT INTO CHUYENBAY(MACB,SBDI,SBDEN,GIODI,GIODEN)
VALUES(112,'DCA','DEN','14:00','18:07')

INSERT INTO CHUYENBAY(MACB,SBDI,SBDEN,GIODI,GIODEN)
VALUES(121,'SLT','SLC','07:00','09:13')

INSERT INTO CHUYENBAY(MACB,SBDI,SBDEN,GIODI,GIODEN)
VALUES(122,'SLT','YYV','08:00','10:19')

INSERT INTO CHUYENBAY(MACB,SBDI,SBDEN,GIODI,GIODEN)
VALUES(206,'DFW','TLV','09:00','11:40')

INSERT INTO CHUYENBAY(MACB,SBDI,SBDEN,GIODI,GIODEN)
VALUES(330,'JFK','YYV','16:00','18:53')

INSERT INTO CHUYENBAY(MACB,SBDI,SBDEN,GIODI,GIODEN)
VALUES(334,'ORD','MIA','12:00','14:14')

INSERT INTO CHUYENBAY(MACB,SBDI,SBDEN,GIODI,GIODEN)
VALUES(335,'MIA','ORD','15:00','17:14')

INSERT INTO CHUYENBAY(MACB,SBDI,SBDEN,GIODI,GIODEN)
VALUES(336,'ORD','MIA','18:00','20:14')

INSERT INTO CHUYENBAY(MACB,SBDI,SBDEN,GIODI,GIODEN)
VALUES(337,'MIA','ORD','20:30','23:53')

INSERT INTO CHUYENBAY(MACB,SBDI,SBDEN,GIODI,GIODEN)
VALUES(394,'DFW','MIA','19:00','21:30')

INSERT INTO CHUYENBAY(MACB,SBDI,SBDEN,GIODI,GIODEN)
VALUES(395,'MIA','DFW','21:00','23:43')

INSERT INTO CHUYENBAY(MACB,SBDI,SBDEN,GIODI,GIODEN)
VALUES(449,'CDG','DEN','10:00','19:29')

INSERT INTO CHUYENBAY(MACB,SBDI,SBDEN,GIODI,GIODEN)
VALUES(930,'YYV','DCA','13:00','16:10')

INSERT INTO CHUYENBAY(MACB,SBDI,SBDEN,GIODI,GIODEN)
VALUES(931,'DCA','YYV','17:00','18:10')

INSERT INTO CHUYENBAY(MACB,SBDI,SBDEN,GIODI,GIODEN)
VALUES(932,'DCA','YYV','18:00','19:10')

INSERT INTO CHUYENBAY(MACB,SBDI,SBDEN,GIODI,GIODEN)
VALUES(991,'BOS','ORD','17:00','18:22')

--NHAP LIEU LICHBAY



INSERT INTO LICHBAY(NGAYDI,MACB,SOHIEU,MALOAI)
VALUES('11/1/2000',100,80,'A310')

INSERT INTO LICHBAY(NGAYDI,MACB,SOHIEU,MALOAI)
VALUES('11/1/2000',112,21,'DC10')

INSERT INTO LICHBAY(NGAYDI,MACB,SOHIEU,MALOAI)
VALUES('11/1/2000',206,22,'DC9')

INSERT INTO LICHBAY(NGAYDI,MACB,SOHIEU,MALOAI)
VALUES('11/1/2000',334,10,'B747')

INSERT INTO LICHBAY(NGAYDI,MACB,SOHIEU,MALOAI)
VALUES('11/1/2000',395,23,'DC9')

INSERT INTO LICHBAY(NGAYDI,MACB,SOHIEU,MALOAI)
VALUES('11/1/2000',991,22,'B757')

INSERT INTO LICHBAY(NGAYDI,MACB,SOHIEU,MALOAI)
VALUES('11/1/2000',337,10,'B747')

INSERT INTO LICHBAY(NGAYDI,MACB,SOHIEU,MALOAI)
VALUES('10/31/2000',100,11,'B727')

INSERT INTO LICHBAY(NGAYDI,MACB,SOHIEU,MALOAI)
VALUES('10/31/2000',112,11,'B727')

INSERT INTO LICHBAY(NGAYDI,MACB,SOHIEU,MALOAI)
VALUES('10/31/2000',206,13,'B727')

INSERT INTO LICHBAY(NGAYDI,MACB,SOHIEU,MALOAI)
VALUES('10/31/2000',334,10,'B747')

INSERT INTO LICHBAY(NGAYDI,MACB,SOHIEU,MALOAI)
VALUES('10/31/2000',335,10,'B747')

INSERT INTO LICHBAY(NGAYDI,MACB,SOHIEU,MALOAI)
VALUES('10/31/2000',337,24,'DC9')

INSERT INTO LICHBAY(NGAYDI,MACB,SOHIEU,MALOAI)
VALUES('10/31/2000',449,70,'A310')

-- NHAP LIEU DATCHO

INSERT INTO DATCHO(MAKH,NGAYDI,MACB)
VALUES(0009,'11/01/2000',100)

INSERT INTO DATCHO(MAKH,NGAYDI,MACB)
VALUES(0045,'11/01/2000',991)

INSERT INTO DATCHO(MAKH,NGAYDI,MACB)
VALUES(0582,'11/01/2000',991)

INSERT INTO DATCHO(MAKH,NGAYDI,MACB)
VALUES(0091,'11/01/2000',100)

INSERT INTO DATCHO(MAKH,NGAYDI,MACB)
VALUES(0613,'11/01/2000',100)

INSERT INTO DATCHO(MAKH,NGAYDI,MACB)
VALUES(0586,'11/01/2000',991)

INSERT INTO DATCHO(MAKH,NGAYDI,MACB)
VALUES(0009,'10/31/2000',449)

INSERT INTO DATCHO(MAKH,NGAYDI,MACB)
VALUES(0012,'10/31/2000',206)

INSERT INTO DATCHO(MAKH,NGAYDI,MACB)
VALUES(0238,'10/31/2000',334)

INSERT INTO DATCHO(MAKH,NGAYDI,MACB)
VALUES(0314,'10/31/2000',449)

INSERT INTO DATCHO(MAKH,NGAYDI,MACB)
VALUES(0586,'10/31/2000',100)

INSERT INTO DATCHO(MAKH,NGAYDI,MACB)
VALUES(0422,'10/31/2000',449)

--NHAP LIEU PHANCONG

INSERT INTO PHANCONG(MANV,NGAYDI,MACB)
VALUES(1001,'11/1/2000',100)

INSERT INTO PHANCONG(MANV,NGAYDI,MACB)
VALUES(1002,'11/1/2000',100)

INSERT INTO PHANCONG(MANV,NGAYDI,MACB)
VALUES(1006,'11/1/2000',991)

INSERT INTO PHANCONG(MANV,NGAYDI,MACB)
VALUES(1007,'11/1/2000',112)

INSERT INTO PHANCONG(MANV,NGAYDI,MACB)
VALUES(1007,'11/1/2000',991)

INSERT INTO PHANCONG(MANV,NGAYDI,MACB)
VALUES(1001,'10/31/2000',100)

INSERT INTO PHANCONG(MANV,NGAYDI,MACB)
VALUES(1002,'10/31/2000',100)

INSERT INTO PHANCONG(MANV,NGAYDI,MACB)
VALUES(1003,'10/31/2000',100)

INSERT INTO PHANCONG(MANV,NGAYDI,MACB)
VALUES(1003,'10/31/2000',337)

INSERT INTO PHANCONG(MANV,NGAYDI,MACB)
VALUES(1004,'10/31/2000',100)

INSERT INTO PHANCONG(MANV,NGAYDI,MACB)
VALUES(1004,'10/31/2000',337)

INSERT INTO PHANCONG(MANV,NGAYDI,MACB)
VALUES(1005,'10/31/2000',337)

INSERT INTO PHANCONG(MANV,NGAYDI,MACB)
VALUES(1006,'10/31/2000',337)

INSERT INTO PHANCONG(MANV,NGAYDI,MACB)
VALUES(1007,'10/31/2000',206)

-- 2. CAC CAU TRUY VAN
--2.1 TRUY VAN DON GIAN
	--1 CHO BIET THONG TINH PHI CONG DA TUNG LAI MAY BAY B747
SELECT NHANVIEN.MANV,NHANVIEN.TEN,NHANVIEN.DCHI,NHANVIEN.DTHOAI
FROM NHANVIEN
INNER JOIN PHANCONG
ON PHANCONG.MANV=NHANVIEN.MANV
INNER JOIN LICHBAY
ON PHANCONG.MACB=LICHBAY.MACB
WHERE LICHBAY.MALOAI='B747' AND NHANVIEN.LOAINV=1
	--2
SELECT CAST (DATEPART (DAY, LICHBAY.NGAYDI) AS VARCHAR)+'/'+CAST (DATEPART (MONTH, LICHBAY.NGAYDI)AS VARCHAR)+'/'+CAST (DATEPART (YEAR, LICHBAY.NGAYDI)AS VARCHAR) AS 'NGAYBAY',LICHBAY.MACB
FROM LICHBAY
INNER JOIN CHUYENBAY ON CHUYENBAY.MACB=LICHBAY.MACB
WHERE CHUYENBAY.SBDI='DCA' AND DATEPART(HOUR, CHUYENBAY.GIODI)>=14 AND DATEPART(HOUR, CHUYENBAY.GIODI)<=18

	--3
SELECT DISTINCT NHANVIEN.TEN
FROM NHANVIEN
INNER JOIN PHANCONG ON PHANCONG.MANV=NHANVIEN.MANV
INNER JOIN CHUYENBAY ON CHUYENBAY.MACB=PHANCONG.MACB
WHERE PHANCONG.MACB=100 AND CHUYENBAY.SBDI='SLC'

	--4
SELECT DISTINCT MAYBAY.SOHIEU,MAYBAY.MALOAI
FROM MAYBAY
INNER JOIN LICHBAY ON LICHBAY.MALOAI=MAYBAY.MALOAI
INNER JOIN CHUYENBAY ON CHUYENBAY.MACB=LICHBAY.MACB
WHERE CHUYENBAY.SBDI='MIA'

	--5
SELECT DATCHO.MACB,DATCHO.NGAYDI,KHACHHANG.TEN,KHACHHANG.DCHI,KHACHHANG.DTHOAI
FROM DATCHO
INNER JOIN KHACHHANG ON KHACHHANG.MAKH=DATCHO.MAKH
ORDER BY DAY(DATCHO.NGAYDI) DESC , DATCHO.MACB

	--6
SELECT A.MACB,A.NGAYDI,B.TEN,B.DCHI,B.DTHOAI
FROM PHANCONG AS A
INNER JOIN NHANVIEN AS B ON A.MANV=B.MANV
ORDER BY DAY(A.NGAYDI) DESC, A.MACB

	--7
SELECT A.MACB,A.NGAYDI,B.MANV,B.TEN
FROM PHANCONG AS A
INNER JOIN NHANVIEN AS B ON A.MANV=B.MANV
INNER JOIN CHUYENBAY AS C ON A.MACB=C.MACB
WHERE B.LOAINV =1 AND C.SBDEN ='ORD'
	--8
SELECT A.MACB,A.NGAYDI,B.TEN
FROM PHANCONG AS A
INNER JOIN NHANVIEN AS B ON A.MANV=B.MANV
WHERE B.MANV=1001
	--9
SELECT A.MACB,A.SBDI,A.GIODI,A.GIODEN,B.NGAYDI
FROM CHUYENBAY AS A
INNER JOIN LICHBAY AS B ON A.MACB=B.MACB
WHERE A.SBDEN ='DEN'
ORDER BY DAY(B.NGAYDI) DESC , A.SBDI
	--10
SELECT A.TEN,B.HANGSX,B.MALOAI
FROM NHANVIEN AS A
INNER JOIN KHANANG AS C ON A.MANV=C.MANV
INNER JOIN LOAIMB AS B ON C.MALOAI=B.MALOAI
	--11
SELECT A.MANV,A.TEN
FROM NHANVIEN AS A
INNER JOIN PHANCONG AS B ON A.MANV=B.MANV
INNER JOIN LICHBAY AS C ON B.MACB=C.MACB
WHERE C.NGAYDI='11/1/2000' AND A.LOAINV=1
ORDER BY A.MANV
	--12
SELECT A.MACB,B.MANV,B.TEN
FROM NHANVIEN AS B
INNER JOIN PHANCONG AS A ON A.MANV=B.MANV
INNER JOIN CHUYENBAY AS C ON C.MACB=A.MACB
WHERE A.NGAYDI='10/31/2000' AND C.SBDI='MIA' AND C.GIODI='20:30'
	--13
SELECT A.MACB,B.SOHIEU,B.MALOAI,C.HANGSX
FROM PHANCONG AS A
INNER JOIN NHANVIEN AS N ON A.MANV=N.MANV
INNER JOIN LICHBAY AS B ON B.MACB=A.MACB
INNER JOIN LOAIMB AS C ON B.MALOAI=C.MALOAI
WHERE N.TEN='QUANG'
	--14
SELECT A.TEN
FROM NHANVIEN AS A
WHERE A.LOAINV=1
EXCEPT
SELECT DISTINCT A.TEN
FROM NHANVIEN AS A
INNER JOIN PHANCONG AS B ON A.MANV=B.MANV
WHERE A.LOAINV=1
	--15
SELECT DISTINCT A.TEN
FROM KHACHHANG AS A
INNER JOIN DATCHO AS B ON A.MAKH=B.MAKH
INNER JOIN LICHBAY AS C ON B.MACB=C.MACB
INNER JOIN LOAIMB AS D ON D.MALOAI=C.MALOAI
WHERE D.HANGSX='BOEING'
	--16
SELECT A.MACB,B.SBDI,B.SBDEN
FROM LICHBAY AS A
INNER JOIN CHUYENBAY AS B ON A.MACB=B.MACB
WHERE A.SOHIEU=10 AND A.MALOAI='B747'

--2.2 GOM NHOM + HAM
	--17
SELECT SBDEN,COUNT(MACB) AS 'SO LUONG MAY BAY'
FROM CHUYENBAY
GROUP BY SBDEN
ORDER BY COUNT(MACB)
	--18
SELECT SBDI,COUNT(MACB) AS 'SO LUONG MAY BAY'
FROM CHUYENBAY
GROUP BY SBDI
ORDER BY COUNT(MACB)
	--19
SELECT A.SBDI,B.NGAYDI,COUNT(A.MACB) AS'SO LUONG CHUYEN BAY'
FROM CHUYENBAY AS A
INNER JOIN LICHBAY AS B ON A.MACB=B.MACB
GROUP BY B.NGAYDI,A.SBDI
ORDER BY B.NGAYDI
	--20
SELECT A.SBDEN,B.NGAYDI,COUNT(A.MACB) AS'SO LUONG CHUYEN BAY'
FROM CHUYENBAY AS A
INNER JOIN LICHBAY AS B ON A.MACB=B.MACB
GROUP BY B.NGAYDI,A.SBDEN
ORDER BY B.NGAYDI
	--21
SELECT A.MACB,A.NGAYDI,COUNT(B.MANV) AS 'SO LUONG NHAN VIEN'
FROM LICHBAY AS A
INNER JOIN PHANCONG AS C ON A.MACB=C.MACB
INNER JOIN NHANVIEN AS B ON B.MANV=C.MANV
WHERE B.LOAINV=0
GROUP BY A.MACB,A.NGAYDI
	--22
SELECT B.NGAYDI,COUNT(A.MACB) AS 'SO LUONG CB'
FROM CHUYENBAY AS A
INNER JOIN LICHBAY AS B ON B.MACB=A.MACB
WHERE A.SBDI='MIA' AND B.NGAYDI='11/1/2000'
GROUP BY B.NGAYDI
	--23
SELECT A.MACB,A.NGAYDI,COUNT(B.MANV) AS 'SO LUONG NV'
FROM LICHBAY AS A
INNER JOIN PHANCONG AS B ON A.MACB=B.MACB
GROUP BY A.MACB,A.NGAYDI
ORDER BY 'SO LUONG NV' DESC
	--24
SELECT A.MACB,A.NGAYDI,COUNT(B.MAKH) AS 'SO LUONG KH'
FROM LICHBAY AS A
INNER JOIN DATCHO AS B ON A.MACB=B.MACB
GROUP BY A.MACB,A.NGAYDI
ORDER BY 'SO LUONG KH' DESC
	--25
SELECT A.MACB,A.NGAYDI,SUM(C.LUONG) AS 'TONG LUONG'
FROM LICHBAY AS A
INNER JOIN PHANCONG AS B ON A.MACB=B.MACB
INNER JOIN NHANVIEN AS C ON B.MANV=C.MANV
GROUP BY A.MACB,A.NGAYDI
ORDER BY 'TONG LUONG'
	--26
SELECT AVG(LUONG) AS 'LUONG TB'
FROM NHANVIEN
WHERE LOAINV=0
	--27
SELECT AVG(LUONG) AS 'LUONG TB'
FROM NHANVIEN
WHERE LOAINV=1
	--28
SELECT A.MALOAI,COUNT(B.MACB)
FROM LOAIMB AS A
INNER JOIN LICHBAY AS B ON A.MALOAI=B.MALOAI
INNER JOIN CHUYENBAY AS C ON B.MACB=C.MACB
WHERE C.SBDEN ='ORD'
GROUP BY A.MALOAI


SELECT A.MALOAI,COUNT(A.MACB)
FROM LICHBAY AS A
INNER JOIN CHUYENBAY AS B ON B.MACB=A.MACB
WHERE B.SBDEN ='ORD'
GROUP BY A.MALOAI
	--29
SELECT SBDI
FROM CHUYENBAY
WHERE DATEPART(HOUR, GIODI) >=10 AND DATEPART(HOUR, GIODEN) <=22
GROUP BY SBDI
HAVING COUNT(MACB) >2

	--30
SELECT A.TEN
FROM NHANVIEN AS A
INNER JOIN PHANCONG AS B ON A.MANV=B.MANV
WHERE A.LOAINV=1
GROUP BY B.NGAYDI,A.TEN
HAVING COUNT(B.MACB)>=2

	--31
SELECT A.MACB,A.NGAYDI
FROM LICHBAY AS A
INNER JOIN DATCHO AS B ON A.MACB=B.MACB
GROUP BY A.MACB,A.NGAYDI
HAVING COUNT(B.MAKH)<3
	--32
SELECT A.SOHIEU,A.MALOAI
FROM LICHBAY AS A
INNER JOIN PHANCONG AS B ON A.MACB=B.MACB
INNER JOIN NHANVIEN AS C ON B.MANV=C.MANV
WHERE C.MANV=1001
GROUP BY A.SOHIEU,A.MALOAI
HAVING COUNT(B.MACB)>=2
	--33
SELECT HANGSX,COUNT(MALOAI) AS 'SO LUONG'
FROM LOAIMB
GROUP BY HANGSX
-- III.TRUY VAN LONG HAM
	--34
SELECT DISTINCT A.HANGSX,A.MALOAI,B.SOHIEU
FROM LOAIMB AS A
INNER JOIN MAYBAY AS B ON A.MALOAI=B.MALOAI
INNER JOIN LICHBAY AS C ON C.SOHIEU=B.SOHIEU
WHERE C.SOHIEU IN (SELECT TOP 1 SOHIEU
FROM LICHBAY
GROUP BY SOHIEU
ORDER BY COUNT(MACB) DESC)
	--35
SELECT DISTINCT A.TEN
FROM NHANVIEN AS A
INNER JOIN PHANCONG AS B ON A.MANV=B.MANV
WHERE B.MANV IN (SELECT TOP 1 MANV 
FROM PHANCONG 
GROUP BY MANV 
ORDER BY COUNT(MACB) DESC )
	--36
SELECT A.TEN, A.DCHI,A.DTHOAI
FROM NHANVIEN AS A
WHERE A.MANV IN (SELECT TOP 1 A.MANV FROM PHANCONG AS A
INNER JOIN NHANVIEN AS B ON A.MANV=B.MANV
WHERE B.LOAINV =1
GROUP BY A.MANV ORDER BY COUNT(A.MACB) DESC )
	--37
SELECT TOP 1 SBDEN,COUNT(MACB) AS 'SO LUONG CB'
FROM CHUYENBAY
GROUP BY SBDEN
ORDER BY COUNT(MACB) ASC
	--38
SELECT TOP 1 SBDI,COUNT(MACB) AS 'SO LUONG CB'
FROM CHUYENBAY
GROUP BY SBDI
ORDER BY COUNT(MACB) DESC
	--39
SELECT TEN,DCHI,DTHOAI
FROM KHACHHANG
WHERE MAKH IN (SELECT TOP 1 MAKH FROM DATCHO GROUP BY MAKH ORDER BY COUNT(MACB) DESC)
	--40
SELECT MANV,TEN,LUONG
FROM NHANVIEN
WHERE MANV IN (SELECT TOP 1 MANV FROM KHANANG GROUP BY MANV ORDER BY COUNT(MALOAI) DESC)
	--41
SELECT TOP 1 MANV,TEN,MAX(LUONG)
FROM NHANVIEN
GROUP BY MANV,TEN













